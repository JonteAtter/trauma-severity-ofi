---
title: 'Association between trauma severity models and opportunities for improvement:
  A retrospective cohort study'
author: "Victoria Witthoff"
output:
  html_document: default
  pdf_document: default
  word_document: default
bibliography: bibliography.bib
csl: vancouver.csl
always_allow_html: true
editor_options: 
   chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r main, echo=FALSE, message = FALSE}
  source("main.R") 
```

Abstract
========

<!-- Provide in the abstract an informative and balanced summary of
what was done and what was found. Not more than 300 words. -->

Background
----------

Methods
-------

Results
-------

Conclusion
----------

Introduction
============



<!-- Explain the scientific background and rationale for the
investigation being reported. End by stating the aim or specific
objectives, including any prespecified hypotheses. The introduction
should not be longer than 1-1.5 pages, typically 4-5 paragraphs, each
6-8 lines long. Support every statement with a citation -->

Methods 
=======

Study design
------------

<!-- Present key elements of study design -->

Setting
-------

<!-- Describe the setting, locations, and relevant dates, including
periods of recruitment, exposure, follow-up, and data collection -->

Participants
------------
<!-- Cohort study: Give the eligibility criteria, and the sources and
methods of selection of participants. -->
Participants were patients registered in both the trauma registry and the trauma care quality database at KUH. The eligibility criteria for this study were the criteria for the two databases used in addition to some study-specific inclusion criteria. 

### Inclusion criteria for the trauma registry

The trauma registry includes all patients for whom the trauma team was activated after receiving a potentially traumatic injury, regardless of NISS score, and all patients with a NISS score >15, regardless of whether the trauma team was activated. Also included are patients who were transferred to the hospital within 7 days of injury and have a NISS score >15. Patients where the only traumatic injury is a chronic subdural hematoma and patients for whom the trauma team was activated without an underlying traumatic injury are excluded from the register.

### Inclusion criteria for the trauma care quality database

The trauma care quality database contains patients from the trauma registry that were selected for M&M review. At KUH, all fatalities are automatically selected for M&M review. In addition to this, the electronic medical records of all trauma patients are screened by research nursing staff to identify cases that potentially received sub-optimal care. These nurses also use audit filters that automatically highlight cases with abnormal parameters. Cases that two research nurses have evaluated and found to have potential for sub-optimal care are also selected for M&M review. Figure 1 gives an overview of the workflow that leads to determination of OFI. 

``` {r, echo = FALSE,} 
  ofi_diagram() ## Only works in HTML
```

### Study-specific exclusion criteria
Patients <15 years of age were excluded as paediatric trauma is a separate clinical entity. Patients that were dead on arrival were also excluded. In addition, this is a complete case study and all patients that lacked parameters necessary to carry out the analysis were excluded. 

Variables and data sources/measurements
---------------------------------------

<!-- Clearly define all outcomes, exposures, predictors, potential
confounders, and effect modifiers. Give diagnostic criteria, if
applicable. For each variable of interest, give sources of data and
details of methods of assessment (measurement). Describe comparability
of assessment methods if there is more than one group -->

Bias 
----

<!-- Describe any efforts to address potential sources of bias -->

Study size 
----------

<!-- Explain how the study size was arrived at -->

Quantitative variables
----------------------

<!-- Explain how quantitative variables were handled in the
analyses. If applicable, describe which groupings were chosen and why
-->

Statistical methods
-------------------

computed CIs for OR using wald estimator. 
<!-- 

(a) Describe all statistical methods, including those used to control
for confounding

(b) Describe any methods used to examine subgroups and interactions

(c) Explain how missing data were addressed 

(d) 

Cohort study: If applicable, explain how loss to follow-up was addressed 

Case-control study:If applicable, explain how matching of cases and
controls was addressed

Cross-sectional study: If applicable, describe analytical methods
taking account of sampling strategy

(e) Describe any sensitivity analyses
-->

Results
=======

Participants
------------
<!-- 
(a) Report numbers of individuals at each stage of study—eg numbers
potentially eligible, examined for eligibility, confirmed eligible,
included in the study, completing follow-up, and analysed

(b) Give reasons for non-participation at each stage

(c) Consider use of a flow diagram

-->
A total of `r counts[6,3]` patients were excluded during processing of data. `r counts[2,3]` patients were excluded due to not having a recorded outcome from an M&M conference. `r counts[3,3]` patients were excluded for being under 15 years of age. `r counts[4,3]` patients were excluded due to being dead on arrival at hospital. `r counts[5,3]` patients were excluded due to missing required data. Figure 2 shows the selection process for eligible participants. 

```{r, echo = FALSE}
  exclusion_flowchart(counts) ## Only works in HTML
```

Descriptive data
----------------

<!--
(a) Give characteristics of study participants (eg demographic,
clinical, social) and information on exposures and potential
confounders

(b) Indicate number of participants with missing data for each
variable of interest

(c) Cohort study — Summarise follow-up time (eg, average and total
amount) -->

A total of `r counts[5,2]` participants were identified as eligible for inclusion. Their demographical and clinical characteristics are described in Table 1. `r numbers['ofi.true']` cases had at least one OFI and `r numbers['ofi.false']` cases had no OFI. The mean age for all patients was `r numbers['mean.age']` and `r numbers['pc.male']`% were male. 

For patients with at least one OFI, the mean TRISS score was `r numbers['t.ofi.t']` and the mean NORMIT score was `r numbers['n.ofi.t']`. For patients with no OFI, the mean TRISS score was `r numbers['t.ofi.f']` and the mean NORMIT score was `r numbers['n.ofi.f']`.  

```{r, echo = FALSE} 
  table.one ## will be improved later
```
  

Detailed totals for missing data for each required parameter are given in table 2. The total number of missing parameters is greater than the number of participants excluded for missing parameters. This is because some patients lacked multiple required parameters. 


```{r gt table, echo = FALSE}
missing
```

Main results
------------

The odds ratio for TRISS was `r t.or['or']` (95% CI: `r t.or[2]`-`r t.or[3]`, p-value: `r t.stats[['or.p']]`). The ROC is plotted in Figure 3. The AUC for the ROC was `r t.stats[['auc']]` (95% CI: `r t.stats[['auc.ci']][1]`-`r t.stats[['auc.ci']][3]`). The integrated calibration index for TRISS was `r t.stats[['ici']]`. The accuracy curve is shown in Figure 4. The best accuracy was `r t.stats[['acc.nrs']][1]` and was found at the cutoff `r t.stats[['acc.nrs']][2]`. 

```{r, echo = FALSE}
plot(t.stats[['perf']], main="Fig 3. TRISS Receiver Operating Characteristic Curve.", colorize = TRUE)
```

```{r, echo = FALSE}
t.plot.acc <- plot(t.stats[['acc']], main="Fig 4. TRISS Accuracy Curve.")
```

The odds ratio for NORMIT was `r n.or['or']` (95% CI: `r n.or[2]`-`r n.or[3]`, p-value: `r n.stats[['or.p']]`). The ROC is plotted in Figure 5. The AUC for the ROC was `r n.stats[['auc']]` (95% CI: `r n.stats[['auc.ci']][1]`-`r n.stats[['auc.ci']][3]`). The integrated calibration index for NORMIT was `r n.stats[['ici']]`. The accuracy curve for NORMIT is shown in Figure 5. The best accuracy was `r n.stats[['acc.nrs']][1]` and was found at the cutoff `r n.stats[['acc.nrs']][2]`. 

```{r, echo = FALSE}
plot(n.stats[['perf']], main="Fig 5. NORMIT Receiver Operating Characteristic Curve.", colorize = TRUE)
```

```{r, echo = FALSE}
n.plot.acc <- plot(n.stats[['acc']], main="Fig 6. NORMIT Accuracy Curve.")
```


Discussion
==========

<!--

Key results
-----------
Summarise key results with reference to study objectives

Limitations
-----------

Discuss limitations of the study, taking into account sources of
potential bias or imprecision.  Discuss both direction and magnitude
of any potential bias

Interpretation
--------------

Give a cautious overall interpretation of results considering
objectives, limitations, multiplicity of analyses, results from
similar studies, and other relevant evidence

Generalisability
----------------

Discuss the generalisability (external validity) of the study results

-->

Conclusion
==========

<!-- Give a short conclusion, corresponding to the aim -->

References
==========

